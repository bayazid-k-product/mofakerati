
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title data-i18n="pageTitle">مفكرتي الإلكترونية المتطورة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Color System */
        :root {
            --primary-color: #6a4c93;
            --secondary-color: #5a3c83;
            --accent-color: #7a5ca3;
            --light-color: #f5f2f9;
            --dark-color: #2a1c43;
            --success-color: #06d6a0;
            --warning-color: #ef476f;
            --speech-color: #8338ec;
            --border-radius: 12px;
            --box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        /* Theme Variations */
        .theme-default { --primary-color: #6a4c93; }
        .theme-ocean { --primary-color: #1a759f; }
        .theme-sunset { --primary-color: #ff7b00; }
        .theme-forest { --primary-color: #2a9d8f; }
        .theme-dark { --primary-color: #7209b7; }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Cairo', sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        body {
            background: var(--light-color);
            color: var(--dark-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            overflow-x: hidden;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 1rem auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            flex: 1;
        }

        header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--accent-color);
        }

        h1 {
            font-size: clamp(1.5rem, 5vw, 2rem);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        h2 {
            font-size: clamp(1rem, 3vw, 1.2rem);
            color: var(--secondary-color);
            margin-bottom: 0.75rem;
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .control-group {
            background: var(--light-color);
            padding: 1rem;
            border-radius: var(--border-radius);
        }

        label {
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: block;
            color: var(--dark-color);
            font-size: clamp(0.9rem, 2vw, 1rem);
        }

        input[type="range"] {
            width: 100%;
            accent-color: var(--primary-color);
        }

        .color-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .color-preview {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            border: 2px solid var(--secondary-color);
        }

        select, textarea, input[type="text"], input[type="color"] {
            border: 1px solid var(--accent-color);
            border-radius: var(--border-radius);
            padding: 0.5rem;
            font-size: clamp(0.9rem, 2vw, 1rem);
            width: 100%;
        }

        input[type="color"] {
            padding: 2px;
            width: 3rem;
            height: 2rem;
        }

        input[type="text"].hex-input {
            width: 6rem;
        }

        textarea {
            min-height: 200px;
            margin-top: 0.5rem;
            resize: vertical;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        button {
            padding: 0.75rem;
            border: none;
            border-radius: var(--border-radius);
            font-size: clamp(0.9rem, 2vw, 1rem);
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background-color: var(--primary-color);
        }

        button:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        button.clear { background-color: var(--warning-color); }
        button.download { background-color: var(--success-color); }
        button.replace { background-color: var(--speech-color); }
        button.speech { background-color: var(--secondary-color); }
        button.stop-speech { background-color: var(--warning-color); }

        .speech-controls {
            margin-top: 1rem;
            background: var(--light-color);
            padding: 1rem;
            border-radius: var(--border-radius);
        }

        #translationResult {
            background: var(--light-color);
            padding: 1rem;
            border: 1px solid var(--accent-color);
            border-radius: var(--border-radius);
            margin-top: 1rem;
        }

        .error-message {
            color: var(--warning-color);
            font-size: clamp(0.8rem, 2vw, 0.9rem);
        }

        .tasks-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
            overflow-x: auto;
        }

        .task-list {
            background: var(--light-color);
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .task-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .task-list-title {
            font-weight: bold;
            color: var(--primary-color);
            font-size: clamp(1rem, 3vw, 1.1rem);
        }

        .task-item {
            background: white;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .task-item.completed {
            opacity: 0.7;
            text-decoration: line-through;
        }

        .task-item.high-priority { border-left: 4px solid var(--warning-color); }
        .task-item.medium-priority { border-left: 4px solid var(--accent-color); }
        .task-item.low-priority { border-left: 4px solid var(--success-color); }

        .task-actions {
            display: flex;
            gap: 0.5rem;
        }

        .task-actions button {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
            width: auto;
        }

        .add-task-form {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .add-task-form input {
            flex: 1;
        }

        .add-task-form button {
            width: 2.5rem;
            padding: 0.5rem;
        }

        .add-list-form {
            margin-top: 1rem;
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--accent-color);
        }

        .tab {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            color: var(--dark-color);
            font-size: clamp(0.9rem, 2vw, 1rem);
        }

        .tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .theme-selector, .language-selector {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .theme-option {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .theme-option:hover {
            transform: scale(1.1);
        }

        .theme-option.selected {
            border-color: var(--dark-color);
            transform: scale(1.1);
        }

        .quick-notes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .note {
            background: var(--light-color);
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            min-height: 100px;
        }

        .note-actions {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
            opacity: 0;
            transition: var(--transition);
            display: flex;
            gap: 0.25rem;
        }

        .note:hover .note-actions {
            opacity: 1;
        }

        .note-actions button {
            width: 1.5rem;
            height: 1.5rem;
            padding: 0;
            border-radius: 50%;
            font-size: 0.7rem;
        }

        .alert {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: clamp(0.8rem, 2vw, 0.9rem);
        }

        .alert-success {
            background-color: var(--success-color);
            color: var(--dark-color);
        }

        .alert-error {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                width: 95%;
                padding: 1rem;
            }
            .control-panel {
                grid-template-columns: 1fr;
            }
            .tasks-container {
                grid-template-columns: 1fr;
            }
            .quick-notes {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        @media (max-width: 768px) {
            body {
                font-size: 0.9rem;
            }
            header {
                flex-direction: column;
                align-items: flex-start;
            }
            h1 {
                font-size: clamp(1.2rem, 4vw, 1.5rem);
            }
            .tabs {
                flex-direction: column;
                align-items: flex-start;
            }
            .tab {
                width: 100%;
                text-align: right;
            }
            .button-group {
                grid-template-columns: 1fr;
            }
            textarea {
                min-height: 150px;
            }
        }

        @media (max-width: 480px) {
            .container {
                width: 100%;
                margin: 0;
                border-radius: 0;
            }
            .control-group {
                padding: 0.75rem;
            }
            .theme-selector, .language-selector {
                flex-wrap: wrap;
            }
            .quick-notes {
                grid-template-columns: 1fr;
            }
            .task-list {
                padding: 0.75rem;
            }
        }

        /* Smart TVs and Large Screens */
        @media (min-width: 1920px) {
            .container {
                max-width: 1400px;
            }
            h1 {
                font-size: 2.5rem;
            }
            h2 {
                font-size: 1.5rem;
            }
            .control-panel {
                grid-template-columns: repeat(3, 1fr);
            }
            .quick-notes {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        /* Square Screens */
        @media (max-aspect-ratio: 1/1) {
            .container {
                width: 85%;
            }
            .control-panel {
                grid-template-columns: 1fr;
            }
            .tasks-container {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            .quick-notes {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
        }

        /* Touch Devices */
        @media (hover: none) {
            button:hover, .theme-option:hover, .task-item:hover {
                transform: none;
                opacity: 1;
            }
            .note-actions {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 data-i18n="headerTitle"><i class="fas fa-book-open"></i> مفكرتي المتطورة</h1>
            <div class="theme-selector">
                <div class="theme-option selected" style="background: #6a4c93;" onclick="changeTheme('default')" title="الافتراضي"></div>
                <div class="theme-option" style="background: #1a759f;" onclick="changeTheme('ocean')" title="المحيط"></div>
                <div class="theme-option" style="background: #ff7b00;" onclick="changeTheme('sunset')" title="الغروب"></div>
                <div class="theme-option" style="background: #2a9d8f;" onclick="changeTheme('forest')" title="الغابة"></div>
                <div class="theme-option" style="background: #7209b7;" onclick="changeTheme('dark')" title="المظلم"></div>
            </div>
            <div class="language-selector">
                <select id="languageSelect" onchange="changeLanguage(this.value)">
                    <option value="ar" selected data-i18n="langArabic">العربية</option>
                    <option value="en" data-i18n="langEnglish">English</option>
                    <option value="fr" data-i18n="langFrench">Français</option>
                    <option value="es" data-i18n="langSpanish">Español</option>
                </select>
            </div>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('diary-tab')" data-i18n="tabDiary"><i class="fas fa-book"></i> المفكرة</div>
            <div class="tab" onclick="switchTab('tasks-tab')" data-i18n="tabTasks"><i class="fas fa-tasks"></i> المهام</div>
            <div class="tab" onclick="switchTab('notes-tab')" data-i18n="tabNotes"><i class="fas fa-sticky-note"></i> الملاحظات</div>
        </div>

        <div id="diary-tab" class="tab-content active">
            <div class="control-panel">
                <div class="control-group">
                    <h2 data-i18n="textSettings"><i class="fas fa-text-height"></i> إعدادات النص</h2>
                    <label for="fontSize" data-i18n="fontSizeLabel">حجم الخط: <span id="fontSizeValue">20px</span></label>
                    <input type="range" id="fontSize" min="10" max="50" value="20" oninput="updateStyles()">
                    <label data-i18n="textColorLabel"><i class="fas fa-palette"></i> لون النص:</label>
                    <div class="color-controls">
                        <input type="color" id="customColor" onchange="setTextColor(this.value)">
                        <input type="text" id="hexColor" class="hex-input" placeholder="#RRGGBB" oninput="setTextColorFromHex(this.value)">
                        <div class="color-preview" id="colorPreview"></div>
                    </div>
                </div>
                <div class="control-group">
                    <h2 data-i18n="translationSettings"><i class="fas fa-language"></i> إعدادات الترجمة</h2>
                    <label for="from_lang" data-i18n="sourceLangLabel">اللغة الأصلية:</label>
                    <select id="from_lang">
                        <option value="ar" selected data-i18n="langArabic">العربية</option>
                        <option value="en" data-i18n="langEnglish">English</option>
                        <option value="fr" data-i18n="langFrench">Français</option>
                        <option value="es" data-i18n="langSpanish">Español</option>
                    </select>
                    <label for="to_lang" data-i18n="targetLangLabel">اللغة المطلوبة:</label>
                    <select id="to_lang">
                        <option value="en" selected data-i18n="langEnglish">English</option>
                        <option value="ar" data-i18n="langArabic">العربية</option>
                        <option value="fr" data-i18n="langFrench">Français</option>
                        <option value="es" data-i18n="langSpanish">Español</option>
                    </select>
                </div>
            </div>
            <textarea id="diary" data-i18n-placeholder="diaryPlaceholder"></textarea>
            <div class="button-group">
                <button onclick="saveDiary()" data-i18n="saveButton"><i class="fas fa-save"></i> حفظ</button>
                <button onclick="clearDiary()" class="clear" data-i18n="clearButton"><i class="fas fa-trash"></i> مسح</button>
                <button onclick="downloadDiary()" class="download" data-i18n="downloadButton"><i class="fas fa-download"></i> تنزيل</button>
                <button onclick="translateText()" data-i18n="translateButton"><i class="fas fa-globe"></i> ترجمة</button>
                <button onclick="replaceWithTranslation()" class="replace" data-i18n="replaceButton"><i class="fas fa-exchange-alt"></i> استبدال</button>
            </div>
            <div class="speech-controls">
                <h2 data-i18n="speechSettings"><i class="fas fa-volume-up"></i> تحويل النص إلى كلام</h2>
                <div class="button-group">
                    <button onclick="speakText()" class="speech" data-i18n="playSpeechButton"><i class="fas fa-play"></i> تشغيل</button>
                    <button onclick="stopSpeech()" class="stop-speech" data-i18n="stopSpeechButton"><i class="fas fa-stop"></i> إيقاف</button>
                </div>
                <div class="speech-rate-control">
                    <label for="speechRate" data-i18n="speechRateLabel">السرعة:</label>
                    <input type="range" id="speechRate" min="0.5" max="2" step="0.1" value="1">
                    <span id="speechRateValue">1</span>
                </div>
                <p id="speechError" class="error-message"></p>
            </div>
            <div id="translationResult"></div>
        </div>

        <div id="tasks-tab" class="tab-content">
            <div id="tasks-alert" class="alert" style="display:none;"></div>
            <div class="tasks-container" id="tasks-container"></div>
            <div class="add-list-form">
                <h2 data-i18n="addTaskList"><i class="fas fa-plus-circle"></i> إضافة قائمة مهام جديدة</h2>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="new-list-name" data-i18n-placeholder="newListPlaceholder" placeholder="اسم القائمة الجديدة">
                    <button onclick="addNewTaskList()" data-i18n="addButton"><i class="fas fa-plus"></i> إضافة</button>
                </div>
            </div>
        </div>

        <div id="notes-tab" class="tab-content">
            <div id="notes-alert" class="alert" style="display:none;"></div>
            <button onclick="addNewNote()" style="margin-bottom: 20px;" data-i18n="addNoteButton"><i class="fas fa-plus"></i> إضافة ملاحظة جديدة</button>
            <div class="quick-notes" id="quick-notes"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        // Translation Dictionary
        const translations = {
            ar: {
                pageTitle: "مفكرتي الإلكترونية المتطورة",
                headerTitle: "مفكرتي المتطورة",
                tabDiary: "المفكرة",
                tabTasks: "المهام",
                tabNotes: "الملاحظات",
                textSettings: "إعدادات النص",
                fontSizeLabel: "حجم الخط:",
                textColorLabel: "لون النص:",
                translationSettings: "إعدادات الترجمة",
                sourceLangLabel: "اللغة الأصلية:",
                targetLangLabel: "اللغة المطلوبة:",
                diaryPlaceholder: "اكتب هنا ما يدور في ذهنك...",
                saveButton: "حفظ",
                clearButton: "مسح",
                downloadButton: "تنزيل",
                translateButton: "ترجمة",
                replaceButton: "استبدال",
                speechSettings: "تحويل النص إلى كلام",
                playSpeechButton: "تشغيل",
                stopSpeechButton: "إيقاف",
                speechRateLabel: "السرعة:",
                addTaskList: "إضافة قائمة مهام جديدة",
                newListPlaceholder: "اسم القائمة الجديدة",
                addButton: "إضافة",
                addNoteButton: "إضافة ملاحظة جديدة",
                langArabic: "العربية",
                langEnglish: "الإنجليزية",
                langFrench: "الفرنسية",
                langSpanish: "الإسبانية",
                saveSuccess: "تم حفظ المفكرة بنجاح!",
                confirmClear: "هل أنت متأكد أنك تريد مسح كل النص؟",
                clearSuccess: "تم مسح المفكرة بنجاح",
                noContent: "لا يوجد محتوى لتنزيله",
                downloadStarted: "تم بدء تنزيل الملف",
                noTextToTranslate: "الرجاء إدخال نص للترجمة",
                translating: "جاري الترجمة، الرجاء الانتظار...",
                translationFailed: "فشل في الاتصال بخدمة الترجمة",
                noValidTranslation: "لم نحصل على ترجمة صالحة",
                translationError: "حدث خطأ في الترجمة:",
                redirectToGoogle: "سيتم توجيهك إلى Google Translate كبديل...",
                translationResult: "نتيجة الترجمة:",
                translationSource: "المصدر: MyMemory Translation",
                useTranslation: "استخدم هذه الترجمة",
                noTranslation: "لا يوجد ترجمة لاستبدالها. الرجاء تنفيذ الترجمة أولاً.",
                confirmReplace: "هل تريد استبدال النص الحالي بالترجمة؟ سيتم حفظ التغييرات تلقائيًا.",
                noTextForSpeech: "الرجاء إدخال نص لتحويله إلى كلام",
                noNativeVoice: "تنبيه: يتم استخدام صوت غير محلي لأن النظام لا يحتوي على أصوات لهذه اللغة",
                noVoices: "لا توجد أصوات متاحة. الرجاء تثبيت أصوات اللغة على نظامك.",
                speechError: "حدث خطأ:",
                defaultTaskList: "المهام العامة",
                newTaskPlaceholder: "إضافة مهمة جديدة",
                priorityLabel: "الأولوية:",
                lowPriority: "منخفضة",
                mediumPriority: "متوسطة",
                highPriority: "عالية",
                noListName: "الرجاء إدخال اسم للقائمة",
                listCreated: "تم إنشاء قائمة بنجاح",
                noTaskText: "الرجاء إدخال نص للمهمة",
                taskAdded: "تم إضافة المهمة بنجاح",
                confirmDeleteTask: "هل أنت متأكد من حذف هذه المهمة؟",
                taskDeleted: "تم حذف المهمة بنجاح",
                confirmDeleteList: "هل أنت متأكد من حذف هذه القائمة وجميع مهامها؟",
                listDeleted: "تم حذف القائمة بنجاح",
                newNoteContent: "ملاحظة جديدة...",
                noteSaved: "تم حفظ الملاحظة بنجاح",
                confirmDeleteNote: "هل أنت متأكد من حذف هذه الملاحظة؟",
                noteDeleted: "تم حذف الملاحظة بنجاح"
            },
            en: {
                pageTitle: "Advanced Electronic Notebook",
                headerTitle: "My Advanced Notebook",
                tabDiary: "Diary",
                tabTasks: "Tasks",
                tabNotes: "Notes",
                textSettings: "Text Settings",
                fontSizeLabel: "Font Size:",
                textColorLabel: "Text Color:",
                translationSettings: "Translation Settings",
                sourceLangLabel: "Source Language:",
                targetLangLabel: "Target Language:",
                diaryPlaceholder: "Write what's on your mind here...",
                saveButton: "Save",
                clearButton: "Clear",
                downloadButton: "Download",
                translateButton: "Translate",
                replaceButton: "Replace",
                speechSettings: "Text to Speech",
                playSpeechButton: "Play",
                stopSpeechButton: "Stop",
                speechRateLabel: "Speed:",
                addTaskList: "Add New Task List",
                newListPlaceholder: "New list name",
                addButton: "Add",
                addNoteButton: "Add New Note",
                langArabic: "Arabic",
                langEnglish: "English",
                langFrench: "French",
                langSpanish: "Spanish",
                saveSuccess: "Notebook saved successfully!",
                confirmClear: "Are you sure you want to clear all text?",
                clearSuccess: "Notebook cleared successfully",
                noContent: "No content to download",
                downloadStarted: "File download started",
                noTextToTranslate: "Please enter text to translate",
                translating: "Translating, please wait...",
                translationFailed: "Failed to connect to translation service",
                noValidTranslation: "No valid translation received",
                translationError: "Translation error:",
                redirectToGoogle: "You will be redirected to Google Translate as an alternative...",
                translationResult: "Translation Result:",
                translationSource: "Source: MyMemory Translation",
                useTranslation: "Use this translation",
                noTranslation: "No translation to replace. Please perform translation first.",
                confirmReplace: "Do you want to replace the current text with the translation? Changes will be saved automatically.",
                noTextForSpeech: "Please enter text to convert to speech",
                noNativeVoice: "Warning: Using a non-native voice as the system lacks voices for this language",
                noVoices: "No voices available. Please install language voices on your system.",
                speechError: "An error occurred:",
                defaultTaskList: "General Tasks",
                newTaskPlaceholder: "Add a new task",
                priorityLabel: "Priority:",
                lowPriority: "Low",
                mediumPriority: "Medium",
                highPriority: "High",
                noListName: "Please enter a name for the list",
                listCreated: "List created successfully",
                noTaskText: "Please enter text for the task",
                taskAdded: "Task added successfully",
                confirmDeleteTask: "Are you sure you want to delete this task?",
                taskDeleted: "Task deleted successfully",
                confirmDeleteList: "Are you sure you want to delete this list and all its tasks?",
                listDeleted: "List deleted successfully",
                newNoteContent: "New note...",
                noteSaved: "Note saved successfully",
                confirmDeleteNote: "Are you sure you want to delete this note?",
                noteDeleted: "Note deleted successfully"
            },
            fr: {
                pageTitle: "Carnet électronique avancé",
                headerTitle: "Mon carnet avancé",
                tabDiary: "Journal",
                tabTasks: "Tâches",
                tabNotes: "Notes",
                textSettings: "Paramètres de texte",
                fontSizeLabel: "Taille de la police :",
                textColorLabel: "Couleur du texte :",
                translationSettings: "Paramètres de traduction",
                sourceLangLabel: "Langue source :",
                targetLangLabel: "Langue cible :",
                diaryPlaceholder: "Écrivez ce qui vous préoccupe ici...",
                saveButton: "Enregistrer",
                clearButton: "Effacer",
                downloadButton: "Télécharger",
                translateButton: "Traduire",
                replaceButton: "Remplacer",
                speechSettings: "Synthèse vocale",
                playSpeechButton: "Lire",
                stopSpeechButton: "Arrêter",
                speechRateLabel: "Vitesse :",
                addTaskList: "Ajouter une nouvelle liste de tâches",
                newListPlaceholder: "Nom de la nouvelle liste",
                addButton: "Ajouter",
                addNoteButton: "Ajouter une nouvelle note",
                langArabic: "Arabe",
                langEnglish: "Anglais",
                langFrench: "Français",
                langSpanish: "Espagnol",
                saveSuccess: "Carnet enregistré avec succès !",
                confirmClear: "Êtes-vous sûr de vouloir effacer tout le texte ?",
                clearSuccess: "Carnet effacé avec succès",
                noContent: "Aucun contenu à télécharger",
                downloadStarted: "Téléchargement du fichier démarré",
                noTextToTranslate: "Veuillez entrer du texte à traduire",
                translating: "Traduction en cours, veuillez patienter...",
                translationFailed: "Échec de la connexion au service de traduction",
                noValidTranslation: "Aucune traduction valide reçue",
                translationError: "Erreur de traduction :",
                redirectToGoogle: "Vous serez redirigé vers Google Translate en alternative...",
                translationResult: "Résultat de la traduction :",
                translationSource: "Source : MyMemory Translation",
                useTranslation: "Utiliser cette traduction",
                noTranslation: "Aucune traduction à remplacer. Veuillez effectuer une traduction d'abord.",
                confirmReplace: "Voulez-vous remplacer le texte actuel par la traduction ? Les modifications seront enregistrées automatiquement.",
                noTextForSpeech: "Veuillez entrer du texte pour la synthèse vocale",
                noNativeVoice: "Avertissement : Utilisation d'une voix non native car le système n'a pas de voix pour cette langue",
                noVoices: "Aucune voix disponible. Veuillez installer des voix pour la langue sur votre système.",
                speechError: "Une erreur s'est produite :",
                defaultTaskList: "Tâches générales",
                newTaskPlaceholder: "Ajouter une nouvelle tâche",
                priorityLabel: "Priorité :",
                lowPriority: "Basse",
                mediumPriority: "Moyenne",
                highPriority: "Haute",
                noListName: "Veuillez entrer un nom pour la liste",
                listCreated: "Liste créée avec succès",
                noTaskText: "Veuillez entrer du texte pour la tâche",
                taskAdded: "Tâche ajoutée avec succès",
                confirmDeleteTask: "Êtes-vous sûr de vouloir supprimer cette tâche ?",
                taskDeleted: "Tâche supprimée avec succès",
                confirmDeleteList: "Êtes-vous sûr de vouloir supprimer cette liste et toutes ses tâches ?",
                listDeleted: "Liste supprimée avec succès",
                newNoteContent: "Nouvelle note...",
                noteSaved: "Note enregistrée avec succès",
                confirmDeleteNote: "Êtes-vous sûr de vouloir supprimer cette note ?",
                noteDeleted: "Note supprimée avec succès"
            },
            es: {
                pageTitle: "Cuaderno electrónico avanzado",
                headerTitle: "Mi cuaderno avanzado",
                tabDiary: "Diario",
                tabTasks: "Tareas",
                tabNotes: "Notas",
                textSettings: "Configuración de texto",
                fontSizeLabel: "Tamaño de fuente:",
                textColorLabel: "Color del texto:",
                translationSettings: "Configuración de traducción",
                sourceLangLabel: "Idioma de origen:",
                targetLangLabel: "Idioma de destino:",
                diaryPlaceholder: "Escribe lo que tienes en mente aquí...",
                saveButton: "Guardar",
                clearButton: "Borrar",
                downloadButton: "Descargar",
                translateButton: "Traducir",
                replaceButton: "Reemplazar",
                speechSettings: "Texto a voz",
                playSpeechButton: "Reproducir",
                stopSpeechButton: "Detener",
                speechRateLabel: "Velocidad:",
                addTaskList: "Agregar nueva lista de tareas",
                newListPlaceholder: "Nombre de la nueva lista",
                addButton: "Agregar",
                addNoteButton: "Agregar nueva nota",
                langArabic: "Árabe",
                langEnglish: "Inglés",
                langFrench: "Francés",
                langSpanish: "Español",
                saveSuccess: "¡Cuaderno guardado con éxito!",
                confirmClear: "¿Estás seguro de que quieres borrar todo el texto?",
                clearSuccess: "Cuaderno borrado con éxito",
                noContent: "No hay contenido para descargar",
                downloadStarted: "Descarga de archivo iniciada",
                noTextToTranslate: "Por favor, introduce texto para traducir",
                translating: "Traduciendo, por favor espera...",
                translationFailed: "No se pudo conectar con el servicio de traducción",
                noValidTranslation: "No se recibió una traducción válida",
                translationError: "Error de traducción:",
                redirectToGoogle: "Serás redirigido a Google Translate como alternativa...",
                translationResult: "Resultado de la traducción:",
                translationSource: "Fuente: MyMemory Translation",
                useTranslation: "Usar esta traducción",
                noTranslation: "No hay traducción para reemplazar. Por favor, realiza la traducción primero.",
                confirmReplace: "¿Quieres reemplazar el texto actual con la traducción? Los cambios se guardarán automáticamente.",
                noTextForSpeech: "Por favor, introduce texto para convertir a voz",
                noNativeVoice: "Advertencia: Usando una voz no nativa porque el sistema no tiene voces para este idioma",
                noVoices: "No hay voces disponibles. Por favor, instala voces para el idioma en tu sistema.",
                speechError: "Ocurrió un error:",
                defaultTaskList: "Tareas generales",
                newTaskPlaceholder: "Agregar una nueva tarea",
                priorityLabel: "Prioridad:",
                lowPriority: "Baja",
                mediumPriority: "Media",
                highPriority: "Alta",
                noListName: "Por favor, introduce un nombre para la lista",
                listCreated: "Lista creada con éxito",
                noTaskText: "Por favor, introduce texto para la tarea",
                taskAdded: "Tarea agregada con éxito",
                confirmDeleteTask: "¿Estás seguro de que quieres eliminar esta tarea?",
                taskDeleted: "Tarea eliminada con éxito",
                confirmDeleteList: "¿Estás seguro de que quieres eliminar esta lista y todas sus tareas?",
                listDeleted: "Lista eliminada con éxito",
                newNoteContent: "Nueva nota...",
                noteSaved: "Nota guardada con éxito",
                confirmDeleteNote: "¿Estás seguro de que quieres eliminar esta nota?",
                noteDeleted: "Nota eliminada con éxito"
            }
        };

        // Helper Functions for Color Processing
        function hexToRgb(hex) {
            hex = hex.replace(/^#/, '');
            let bigint = parseInt(hex, 16);
            let r = (bigint >> 16) & 255;
            let g = (bigint >> 8) & 255;
            let b = bigint & 255;
            return { r, g, b };
        }

        function rgbToHex(r, g, b) {
            return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).padStart(6, '0')}`;
        }

        function adjustBrightness({ r, g, b }, factor) {
            r = Math.min(255, Math.max(0, Math.round(r * factor)));
            g = Math.min(255, Math.max(0, Math.round(g * factor)));
            b = Math.min(255, Math.max(0, Math.round(b * factor)));
            return rgbToHex(r, g, b);
        }

        function generateThemeColors(primaryColor) {
            const rgb = hexToRgb(primaryColor);
            const secondaryColor = adjustBrightness(rgb, 0.8);
            const accentColor = adjustBrightness(rgb, 1.2);
            const lightColor = adjustBrightness(rgb, 1.5);
            const darkColor = adjustBrightness(rgb, 0.4);
            const successColor = adjustBrightness(rgb, 1.1);
            const warningColor = adjustBrightness(rgb, 0.9);
            const speechColor = adjustBrightness(rgb, 1.3);
            document.documentElement.style.setProperty('--secondary-color', secondaryColor);
            document.documentElement.style.setProperty('--accent-color', accentColor);
            document.documentElement.style.setProperty('--light-color', lightColor);
            document.documentElement.style.setProperty('--dark-color', darkColor);
            document.documentElement.style.setProperty('--success-color', successColor);
            document.documentElement.style.setProperty('--warning-color', warningColor);
            document.documentElement.style.setProperty('--speech-color', speechColor);
        }

        // Language Change Function
        function changeLanguage(lang) {
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = translations[lang][key];
                    } else {
                        const icon = element.querySelector('i');
                        element.textContent = translations[lang][key];
                        if (icon) {
                            element.prepend(icon);
                        }
                    }
                }
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });

            document.title = translations[lang].pageTitle;
            const isRtl = lang === 'ar';
            document.documentElement.setAttribute('dir', isRtl ? 'rtl' : 'ltr');
            document.documentElement.setAttribute('lang', lang);
            localStorage.setItem('selectedLanguage', lang);

            if (lang === 'ar') {
                speechLang = 'ar-SA';
            } else if (lang === 'en') {
                speechLang = 'en-US';
            } else if (lang === 'fr') {
                speechLang = 'fr-FR';
            } else if (lang === 'es') {
                speechLang = 'es-ES';
            }

            loadTaskLists();
        }

        // Load Settings on Page Load
        window.onload = function() {
            loadSettings();
            updateStyles();
            setupSpeechControls();
            loadTaskLists();
            loadQuickNotes();
            const savedTheme = localStorage.getItem('selectedTheme');
            if (savedTheme) {
                changeTheme(savedTheme);
            }
            const savedLanguage = localStorage.getItem('selectedLanguage') || 'ar';
            document.getElementById('languageSelect').value = savedLanguage;
            changeLanguage(savedLanguage);
            if (!('speechSynthesis' in window)) {
                document.getElementById('speechError').textContent = translations[savedLanguage].speechError || 'المتصفح لا يدعم ميزة تحويل النص إلى كلام';
                document.querySelector('.speech-controls button').disabled = true;
            }
        };

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function changeTheme(themeName) {
            document.body.classList.remove('theme-default', 'theme-ocean', 'theme-sunset', 'theme-forest', 'theme-dark');
            if (themeName !== 'default') {
                document.body.classList.add(`theme-${themeName}`);
            } else {
                document.body.classList.add('theme-default');
            }
            let primaryColor;
            switch (themeName) {
                case 'ocean':
                    primaryColor = '#1a759f';
                    break;
                case 'sunset':
                    primaryColor = '#ff7b00';
                    break;
                case 'forest':
                    primaryColor = '#2a9d8f';
                    break;
                case 'dark':
                    primaryColor = '#7209b7';
                    break;
                default:
                    primaryColor = '#6a4c93';
            }
            document.documentElement.style.setProperty('--primary-color', primaryColor);
            generateThemeColors(primaryColor);
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            localStorage.setItem('selectedTheme', themeName);
        }

        function setupSpeechControls() {
            const rateInput = document.getElementById('speechRate');
            const rateValue = document.getElementById('speechRateValue');
            rateInput.addEventListener('input', () => {
                rateValue.textContent = rateInput.value;
            });
        }

        function loadSettings() {
            const savedText = localStorage.getItem('diaryText');
            if (savedText) {
                document.getElementById('diary').value = savedText;
            }
            const savedFontSize = localStorage.getItem('fontSize');
            if (savedFontSize) {
                document.getElementById('fontSize').value = savedFontSize;
                document.getElementById('fontSizeValue').textContent = savedFontSize + 'px';
            }
            const savedColor = localStorage.getItem('textColor');
            if (savedColor) {
                const color = savedColor;
                document.getElementById('customColor').value = color;
                document.getElementById('hexColor').value = color;
                document.getElementById('diary').style.color = color;
                document.getElementById('colorPreview').style.backgroundColor = color;
            }
        }

        function saveDiary() {
            const diaryText = document.getElementById('diary').value;
            localStorage.setItem('diaryText', diaryText);
            const fontSize = document.getElementById('fontSize').value;
            localStorage.setItem('fontSize', fontSize);
            const color = document.getElementById('customColor').value;
            localStorage.setItem('textColor', color);
            const lang = document.getElementById('languageSelect').value;
            showAlert('diary-tab', translations[lang].saveSuccess || 'تم حفظ المفكرة بنجاح!', 'success');
        }

        function showAlert(tabId, message, type) {
            const alertDiv = document.querySelector(`#${tabId} .alert`);
            alertDiv.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : 'exclamation'}-circle"></i> ${message}`;
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.display = 'flex';
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 3000);
        }

        function updateStyles() {
            const fontSize = document.getElementById('fontSize').value;
            document.getElementById('diary').style.fontSize = fontSize + 'px';
            document.getElementById('fontSizeValue').textContent = fontSize + 'px';
            const color = document.getElementById('customColor').value;
            document.getElementById('diary').style.color = color;
            document.getElementById('colorPreview').style.backgroundColor = color;
            document.getElementById('hexColor').value = color;
        }

        function setTextColor(color) {
            document.getElementById('diary').style.color = color;
            document.getElementById('colorPreview').style.backgroundColor = color;
            document.getElementById('hexColor').value = color;
        }

        function setTextColorFromHex(hex) {
            const hexRegex = /^#?([0-9A-Fa-f]{6})$/;
            const cleanedHex = hex.startsWith('#') ? hex : `#${hex}`;
            if (hexRegex.test(cleanedHex)) {
                document.getElementById('customColor').value = cleanedHex;
                document.getElementById('diary').style.color = cleanedHex;
                document.getElementById('colorPreview').style.backgroundColor = cleanedHex;
            }
        }

        function clearDiary() {
            const lang = document.getElementById('languageSelect').value;
            if (confirm(translations[lang].confirmClear || 'هل أنت متأكد أنك تريد مسح كل النص؟')) {
                document.getElementById('diary').value = '';
                localStorage.removeItem('diaryText');
                showAlert('diary-tab', translations[lang].clearSuccess || 'تم مسح المفكرة بنجاح', 'success');
            }
        }

        function downloadDiary() {
            const text = document.getElementById('diary').value;
            const lang = document.getElementById('languageSelect').value;
            if (!text) {
                showAlert('diary-tab', translations[lang].noContent || 'لا يوجد محتوى لتنزيله', 'error');
                return;
            }
            const filename = (translations[lang].diaryFile || "مفكرتي_") + new Date().toISOString().split('T')[0] + ".txt";
            const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
            saveAs(blob, filename);
            showAlert('diary-tab', translations[lang].downloadStarted || 'تم بدء تنزيل الملف', 'success');
        }

        async function translateText() {
            const text = document.getElementById('diary').value;
            const fromLang = document.getElementById('from_lang').value;
            const toLang = document.getElementById('to_lang').value;
            const lang = document.getElementById('languageSelect').value;
            if (!text.trim()) {
                showAlert('diary-tab', translations[lang].noTextToTranslate || 'الرجاء إدخال نص للترجمة', 'error');
                return;
            }
            const resultDiv = document.getElementById('translationResult');
            resultDiv.innerHTML = `<p><i class="fas fa-spinner fa-spin"></i> ${translations[lang].translating || 'جاري الترجمة، الرجاء الانتظار...'}</p>`;
            try {
                const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${fromLang}|${toLang}`);
                if (!response.ok) {
                    throw new Error(translations[lang].translationFailed || 'فشل في الاتصال بخدمة الترجمة');
                }
                const data = await response.json();
                if (data.responseData && data.responseData.translatedText) {
                    resultDiv.innerHTML = `
                        <h3><i class="fas fa-language"></i> ${translations[lang].translationResult || 'نتيجة الترجمة:'}</h3>
                        <p>${data.responseData.translatedText}</p>
                        <p class="translation-meta"><i class="fas fa-info-circle"></i> ${translations[lang].translationSource || 'المصدر: MyMemory Translation'}</p>
                        <button onclick="useTranslation()" style="margin-top:10px;"><i class="fas fa-check"></i> ${translations[lang].useTranslation || 'استخدم هذه الترجمة'}</button>
                    `;
                } else {
                    throw new Error(translations[lang].noValidTranslation || 'لم نحصل على ترجمة صالحة');
                }
            } catch (error) {
                console.error('Translation error:', error);
                resultDiv.innerHTML = `
                    <p style="color: var(--warning-color);"><i class="fas fa-exclamation-triangle"></i> ${translations[lang].translationError || 'حدث خطأ في الترجمة:'} ${error.message}</p>
                    <p><i class="fas fa-sync-alt"></i> ${translations[lang].redirectToGoogle || 'سيتم توجيهك إلى Google Translate كبديل...'}</p>
                `;
                setTimeout(() => {
                    window.open(`https://translate.google.com/?sl=${fromLang}&tl=${toLang}&text=${encodeURIComponent(text)}`, '_blank');
                }, 2000);
            }
        }

        async function replaceWithTranslation() {
            const resultDiv = document.getElementById('translationResult');
            const translation = resultDiv.querySelector('p:nth-of-type(1)');
            const lang = document.getElementById('languageSelect').value;
            if (!translation || !translation.textContent || translation.textContent.includes(translations[lang].translating || 'جاري الترجمة')) {
                showAlert('diary-tab', translations[lang].noTranslation || 'لا يوجد ترجمة لاستبدالها. الرجاء تنفيذ الترجمة أولاً.', 'error');
                return;
            }
            if (confirm(translations[lang].confirmReplace || 'هل تريد استبدال النص الحالي بالترجمة؟ سيتم حفظ التغييرات تلقائيًا.')) {
                document.getElementById('diary').value = translation.textContent;
                saveDiary();
            }
        }

        function useTranslation() {
            replaceWithTranslation();
        }

        function speakText() {
            const text = document.getElementById('diary').value.trim();
            const errorElement = document.getElementById('speechError');
            const lang = document.getElementById('languageSelect').value;
            if (!text) {
                errorElement.textContent = translations[lang].noTextForSpeech || 'الرجاء إدخال نص لتحويله إلى كلام';
                return;
            }
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang === 'ar' ? 'ar-SA' : lang === 'en' ? 'en-US' : lang === 'fr' ? 'fr-FR' : 'es-ES';
            utterance.rate = Math.min(1.2, parseFloat(document.getElementById('speechRate').value || 1));
            const voices = window.speechSynthesis.getVoices();
            const targetVoice = voices.find(voice => voice.lang.startsWith(lang));
            if (targetVoice) {
                utterance.voice = targetVoice;
            } else if (voices.length > 0) {
                utterance.voice = voices[0];
                errorElement.textContent = translations[lang].noNativeVoice || 'تنبيه: يتم استخدام صوت غير محلي لأن النظام لا يحتوي على أصوات لهذه اللغة';
            } else {
                errorElement.textContent = translations[lang].noVoices || 'لا توجد أصوات متاحة. الرجاء تثبيت أصوات اللغة على نظامك.';
                return;
            }
            window.speechSynthesis.speak(utterance);
            utterance.onerror = function(event) {
                errorElement.textContent = translations[lang].speechError || 'حدث خطأ: ' + event.error;
            };
            utterance.onend = function() {
                console.log('Speech finished');
            };
        }

        function stopSpeech() {
            window.speechSynthesis.cancel();
            document.getElementById('speechError').textContent = '';
        }

        if ('speechSynthesis' in window) {
            window.speechSynthesis.onvoiceschanged = function() {
                console.log('Available voices:', window.speechSynthesis.getVoices());
            };
        }

        function loadTaskLists() {
            const savedLists = localStorage.getItem('taskLists');
            const container = document.getElementById('tasks-container');
            container.innerHTML = '';
            if (savedLists) {
                const lists = JSON.parse(savedLists);
                lists.forEach(list => {
                    addTaskListToDOM(list);
                });
            } else {
                const lang = document.getElementById('languageSelect').value;
                addTaskListToDOM({
                    id: Date.now(),
                    name: translations[lang].defaultTaskList || 'المهام العامة',
                    tasks: []
                });
            }
        }

        function addTaskListToDOM(list) {
            const container = document.getElementById('tasks-container');
            const listElement = document.createElement('div');
            listElement.className = 'task-list';
            listElement.dataset.listId = list.id;
            const lang = document.getElementById('languageSelect').value;
            listElement.innerHTML = `
                <div class="task-list-header">
                    <div class="task-list-title">${list.name}</div>
                    <div class="task-list-actions">
                        <button onclick="deleteTaskList(${list.id})" style="padding: 2px 5px; font-size: 0.8rem;"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                <div class="task-items" id="tasks-${list.id}">
                    ${list.tasks.map(task => createTaskHTML(task)).join('')}
                </div>
                <div class="add-task-form">
                    <input type="text" id="new-task-${list.id}" data-i18n-placeholder="newTaskPlaceholder" placeholder="${translations[lang].newTaskPlaceholder || 'إضافة مهمة جديدة'}">
                    <button onclick="addTask(${list.id})"><i class="fas fa-plus"></i></button>
                </div>
                <div class="priority-controls" style="margin-top: 10px;">
                    <label data-i18n="priorityLabel">${translations[lang].priorityLabel || 'الأولوية:'}</label>
                    <select id="priority-${list.id}" style="margin-top: 5px;">
                        <option value="low" data-i18n="lowPriority">${translations[lang].lowPriority || 'منخفضة'}</option>
                        <option value="medium" selected data-i18n="mediumPriority">${translations[lang].mediumPriority || 'متوسطة'}</option>
                        <option value="high" data-i18n="highPriority">${translations[lang].highPriority || 'عالية'}</option>
                    </select>
                </div>
            `;
            container.appendChild(listElement);
        }

        function createTaskHTML(task) {
            return `
                <div class="task-item ${task.completed ? 'completed' : ''} ${task.priority}-priority" data-task-id="${task.id}">
                    <span>${task.text}</span>
                    <div class="task-actions">
                        <button onclick="toggleTaskCompletion(${task.listId}, ${task.id})">
                            <i class="fas fa-${task.completed ? 'check-square' : 'square'}"></i>
                        </button>
                        <button onclick="deleteTask(${task.listId}, ${task.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        }

        function addNewTaskList() {
            const nameInput = document.getElementById('new-list-name');
            const name = nameInput.value.trim();
            const lang = document.getElementById('languageSelect').value;
            if (!name) {
                showAlert('tasks-tab', translations[lang].noListName || 'الرجاء إدخال اسم للقائمة', 'error');
                return;
            }
            const newList = {
                id: Date.now(),
                name: name,
                tasks: []
            };
            addTaskListToDOM(newList);
            saveTaskLists();
            nameInput.value = '';
            showAlert('tasks-tab', translations[lang].listCreated || `تم إنشاء قائمة "${name}" بنجاح`, 'success');
        }

        function addTask(listId) {
            const input = document.querySelector(`#new-task-${listId}`);
            const text = input.value.trim();
            const priority = document.querySelector(`#priority-${listId}`).value;
            const lang = document.getElementById('languageSelect').value;
            if (!text) {
                showAlert('tasks-tab', translations[lang].noTaskText || 'الرجاء إدخال نص للمهمة', 'error');
                return;
            }
            const newTask = {
                id: Date.now(),
                listId: listId,
                text: text,
                priority: priority,
                completed: false
            };
            const tasksContainer = document.querySelector(`#tasks-${listId}`);
            tasksContainer.innerHTML += createTaskHTML(newTask);
            saveTaskLists();
            input.value = '';
            showAlert('tasks-tab', translations[lang].taskAdded || 'تم إضافة المهمة بنجاح', 'success');
        }

        function toggleTaskCompletion(listId, taskId) {
            const savedLists = JSON.parse(localStorage.getItem('taskLists'));
            const listIndex = savedLists.findIndex(list => list.id == listId);
            if (listIndex !== -1) {
                const taskIndex = savedLists[listIndex].tasks.findIndex(task => task.id == taskId);
                if (taskIndex !== -1) {
                    savedLists[listIndex].tasks[taskIndex].completed = !savedLists[listIndex].tasks[taskIndex].completed;
                    localStorage.setItem('taskLists', JSON.stringify(savedLists));
                    loadTaskLists();
                }
            }
        }

        function deleteTask(listId, taskId) {
            const lang = document.getElementById('languageSelect').value;
            if (confirm(translations[lang].confirmDeleteTask || 'هل أنت متأكد من حذف هذه المهمة؟')) {
                const savedLists = JSON.parse(localStorage.getItem('taskLists'));
                const listIndex = savedLists.findIndex(list => list.id == listId);
                if (listIndex !== -1) {
                    savedLists[listIndex].tasks = savedLists[listIndex].tasks.filter(task => task.id != taskId);
                    localStorage.setItem('taskLists', JSON.stringify(savedLists));
                    loadTaskLists();
                    showAlert('tasks-tab', translations[lang].taskDeleted || 'تم حذف المهمة بنجاح', 'success');
                }
            }
        }

        function deleteTaskList(listId) {
            const lang = document.getElementById('languageSelect').value;
            if (confirm(translations[lang].confirmDeleteList || 'هل أنت متأكد من حذف هذه القائمة وجميع مهامها؟')) {
                const savedLists = JSON.parse(localStorage.getItem('taskLists'));
                const updatedLists = savedLists.filter(list => list.id != listId);
                localStorage.setItem('taskLists', JSON.stringify(updatedLists));
                loadTaskLists();
                showAlert('tasks-tab', translations[lang].listDeleted || 'تم حذف القائمة بنجاح', 'success');
            }
        }

        function saveTaskLists() {
            const lists = [];
            document.querySelectorAll('.task-list').forEach(listElement => {
                const listId = parseInt(listElement.dataset.listId);
                const listName = listElement.querySelector('.task-list-title').textContent;
                const tasks = [];
                listElement.querySelectorAll('.task-item').forEach(taskElement => {
                    const taskId = parseInt(taskElement.dataset.taskId);
                    const taskText = taskElement.querySelector('span').textContent;
                    const taskPriority = taskElement.className.includes('high-priority') ? 'high' : 
                                        taskElement.className.includes('medium-priority') ? 'medium' : 'low';
                    const taskCompleted = taskElement.className.includes('completed');
                    tasks.push({
                        id: taskId,
                        listId: listId,
                        text: taskText,
                        priority: taskPriority,
                        completed: taskCompleted
                    });
                });
                lists.push({
                    id: listId,
                    name: listName,
                    tasks: tasks
                });
            });
            localStorage.setItem('taskLists', JSON.stringify(lists));
        }

        function loadQuickNotes() {
            const savedNotes = localStorage.getItem('quickNotes');
            const container = document.getElementById('quick-notes');
            container.innerHTML = '';
            if (savedNotes) {
                const notes = JSON.parse(savedNotes);
                notes.forEach(note => {
                    addNoteToDOM(note);
                });
            }
        }

        function addNewNote() {
            const lang = document.getElementById('languageSelect').value;
            const newNote = {
                id: Date.now(),
                content: translations[lang].newNoteContent || 'ملاحظة جديدة...',
                createdAt: new Date().toISOString()
            };
            addNoteToDOM(newNote);
            saveQuickNotes();
            const noteElement = document.querySelector(`.note[data-note-id="${newNote.id}"]`);
            noteElement.contentEditable = true;
            noteElement.focus();
        }

        function addNoteToDOM(note) {
            const container = document.getElementById('quick-notes');
            const noteElement = document.createElement('div');
            noteElement.className = 'note';
            noteElement.dataset.noteId = note.id;
            noteElement.innerHTML = `
                <div class="note-actions">
                    <button onclick="editNote(${note.id})"><i class="fas fa-edit"></i></button>
                    <button onclick="deleteNote(${note.id})"><i class="fas fa-trash"></i></button>
                    <button onclick="saveNote(${note.id})" style="display: none;"><i class="fas fa-save"></i></button>
                </div>
                <div class="note-content">${note.content}</div>
                <div class="note-date" style="font-size: 0.8rem; color: var(--dark-color); margin-top: 10px;">
                    <i class="far fa-clock"></i> ${new Date(note.createdAt).toLocaleString()}
                </div>
            `;
            container.appendChild(noteElement);
        }

        function editNote(noteId) {
            const noteElement = document.querySelector(`.note[data-note-id="${noteId}"]`);
            const contentDiv = noteElement.querySelector('.note-content');
            contentDiv.contentEditable = true;
            contentDiv.focus();
            noteElement.querySelector('.note-actions button:nth-child(3)').style.display = 'inline-block';
        }

        function saveNote(noteId) {
            const noteElement = document.querySelector(`.note[data-note-id="${noteId}"]`);
            const contentDiv = noteElement.querySelector('.note-content');
            contentDiv.contentEditable = false;
            noteElement.querySelector('.note-actions button:nth-child(3)').style.display = 'none';
            const savedNotes = JSON.parse(localStorage.getItem('quickNotes')) || [];
            const noteIndex = savedNotes.findIndex(note => note.id == noteId);
            const lang = document.getElementById('languageSelect').value;
            if (noteIndex !== -1) {
                savedNotes[noteIndex].content = contentDiv.innerHTML;
                localStorage.setItem('quickNotes', JSON.stringify(savedNotes));
                showAlert('notes-tab', translations[lang].noteSaved || 'تم حفظ الملاحظة بنجاح', 'success');
            }
        }

        function deleteNote(noteId) {
            const lang = document.getElementById('languageSelect').value;
            if (confirm(translations[lang].confirmDeleteNote || 'هل أنت متأكد من حذف هذه الملاحظة؟')) {
                const savedNotes = JSON.parse(localStorage.getItem('quickNotes')) || [];
                const updatedNotes = savedNotes.filter(note => note.id != noteId);
                localStorage.setItem('quickNotes', JSON.stringify(updatedNotes));
                loadQuickNotes();
                showAlert('notes-tab', translations[lang].noteDeleted || 'تم حذف الملاحظة بنجاح', 'success');
            }
        }

        function saveQuickNotes() {
            const notes = [];
            document.querySelectorAll('.note').forEach(noteElement => {
                const noteId = parseInt(noteElement.dataset.noteId);
                const content = noteElement.querySelector('.note-content').textContent;
                const dateElement = noteElement.querySelector('.note-date');
                const createdAt = dateElement ? dateElement.textContent.replace('<i class="far fa-clock"></i> ', '') : new Date().toISOString();
                notes.push({
                    id: noteId,
                    content: content,
                    createdAt: createdAt
                });
            });
            localStorage.setItem('quickNotes', JSON.stringify(notes));
        }
    </script>
</body>
</html>
